name=libstdc++
from_source=gcc-host
revision=1
hostdeps="gcc autoconf automake libtool pkg-config"
imagedeps="gcc"
deps="mlibc libgcc"

configure() {
  true
}

build() {
  make -C ${base_dir}/host-builds/gcc/build -j${parallelism} all-target-libstdc++-v3
}

install() {
  mkdir -p tmp_libstdcxx_dir
  make -C ${base_dir}/host-builds/gcc/build DESTDIR=$(realpath tmp_libstdcxx_dir) install-strip-target-libstdc++-v3

  mkdir -p ${dest_dir}${prefix}
  cp -r tmp_libstdcxx_dir/usr/local/share ${dest_dir}${prefix}/
  cp -r tmp_libstdcxx_dir/usr/local/${common_target}/* ${dest_dir}${prefix}/

  # Remove static libraries
  rm -rf ${dest_dir}${prefix}/lib/*.a

  # Copy libstdc++ and headers into GCC's tree else it will complain.
  mkdir -p ${base_dir}/host-pkgs/gcc/usr/local/${common_target}
  cp -r tmp_libstdcxx_dir/usr/local/${common_target}/* ${base_dir}/host-pkgs/gcc/usr/local/${common_target}/
}
